# 电子书阅读器 (Electron 桌面应用)

这是一个使用 Electron 框架构建的桌面电子书阅读器，它利用 Web 技术 (HTML, CSS, JavaScript) 来构建用户界面和核心功能。应用支持 EPUB 和 TXT 格式的书籍阅读，采用了模块化的代码结构，并使用 IndexedDB 实现书籍数据的持久化存储。

## 技术栈

*   **前端**: HTML, CSS, JavaScript (ES6 Modules)
*   **EPUB 解析与渲染**: [epub.js](https://github.com/futurepress/epub.js/)
*   **数据持久化**:
    *   **IndexedDB**: 用于存储书籍文件内容、元数据和书签。
    *   **localStorage**: 用于保存用户设置（如主题、字号、API配置）。

## 功能

*   **持久化书库**: 使用 IndexedDB 保存导入的书籍，关闭浏览器后不清空。
*   **文件导入**: 支持本地 EPUB (.epub) 和 TXT (.txt) 文件。
*   **EPUB 功能**:
    *   章节目录导航。
    *   书签功能（添加、跳转、删除），并随书本保存。
    *   自动提取并显示书籍封面。
*   **通用功能**:
    *   流畅的翻页体验。
    *   可折叠的设置菜单。
    *   **主题切换**: 明亮/暗黑模式。
    *   **字体大小调整**。
    *   **OpenAI API 配置**: 可自定义 API 地址、密钥和模型名称。
*   **（待集成）** 与兼容 OpenAI 接口的服务交互，用于处理用户提问。

## 项目结构

项目采用了模块化的设计，将不同的功能逻辑分离到独立的文件中，使代码更清晰、更易于维护。

*   `index.html`: 应用程序的主HTML文件，定义了页面结构。
*   `style.css`: 应用程序的样式文件，控制外观和布局。
*   `js/`: 存放所有 JavaScript 模块的目录。
    *   `app.js`: **(主模块)** 应用程序的入口和协调器，负责初始化应用、绑定事件监听器和协调其他模块。
    *   `database.js`: **(数据模块)** 封装了所有与 IndexedDB 相关的操作，如初始化数据库、保存/读取/更新书籍数据。
    *   `ui.js`: **(UI模块)** 负责所有与用户界面相关的操作，如渲染书籍列表、目录、书签等。
*   `node_modules/`: **(自动生成)** 当您运行 `npm install` 时，此目录会被自动创建。它包含了项目运行和构建所需的所有第三方库和工具（即“依赖项”），如 Electron 和 electron-builder。此目录不应被手动修改。
*   `README.md`: 本文件，提供项目说明。

## 待办事项

*   集成 OpenAI 接口，实现提问功能。
*   优化性能和用户体验，尤其是在处理大型书籍时。
*   添加更多设置选项（如行高、边距等）。

## 如何运行

这是一个 Electron 桌面应用程序。

1.  确保您的电脑上安装了 [Node.js](https://nodejs.org/)。
2.  在项目的根目录下打开终端。
3.  运行 `npm install` 来安装所有依赖项。
4.  运行 `npm start` 来启动应用程序。

## 如何打包

要将应用程序打包成一个可执行文件（例如 Windows 平台的 `.exe`），请运行：

```bash
npm run dist
```

打包好的文件将位于项目根目录下的 `dist/` 文件夹中。

## 调试指南

调试 Electron 应用分为两个部分：渲染器进程和主进程。

### 1. 调试渲染器进程 (Web 页面)

这是最常见的调试场景，负责您应用的所有前端逻辑 (`app.js`, `ui.js` 等)。

1.  运行 `npm start` 启动应用。
2.  应用窗口启动时，Chrome 开发者工具会自动打开。
3.  您可以在 **Console** 标签页查看 `console.log` 输出和错误信息。
4.  您可以在 **Sources** 标签页找到您的代码（如 `app.js`），并设置断点进行调试。
5.  您可以在 **Application** 标签页检查 IndexedDB 和 localStorage 的数据。

### 2. 调试主进程 (`main.js`)

主进程是一个 Node.js 环境，负责创建窗口和处理系统事件。

1.  在 VS Code 中，打开 `main.js` 文件。
2.  在您想要暂停执行的代码行号左侧单击，设置一个断点（会出现一个红点）。
3.  转到 VS Code 的 "Run and Debug" 视图 (通常在左侧边栏，图标是带有一个播放按钮的虫子)。
4.  点击顶部的 "Run and Debug" 绿色播放按钮，VS Code 会自动启动 Electron 应用并附加调试器。
5.  当代码执行到您设置的断点时，程序会暂停，您可以在 VS Code 的调试面板中检查变量、单步执行代码等。

## 版本历史

### v0.2.0 (2025-07-04)

**修复 (Bug Fixes):**

*   **修复设置页面布局重叠问题**: 重写了视图切换逻辑，确保在进入设置页面时，书库和阅读器视图会被正确隐藏，解决了内容重叠的 bug。
*   **修复右键删除图书功能**: 恢复了在渲染进程中处理删除图书事件的逻辑，现在右键点击图书并选择“删除”后，会弹出确认框，确认后即可成功删除图书。

**改进 (Improvements):**

*   **UI/UX 优化**: 进一步调整了设置页面的布局和样式，使其在不同窗口尺寸下都能保持良好的显示效果。
>>>>>>> REPLACE
